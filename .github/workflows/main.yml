name: Deploy to Alibaba ECS

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Set up Node.js
      uses: actions/setup-node@v2
      with:
        node-version: '14'
        
    - name: Install dependencies
      run: npm install

    - name: Deploy to Alibaba ECS
      env:
        ACCESS_KEY_ID: LTAI5tLGmAQtsnbv9CLX1DHV
        ACCESS_KEY_SECRET: w0syCcTuTogX4ZpG5Eo9q6yhSLKBzf
      run: |
        # Install Alibaba Cloud CLI
        - name: Install Alibaba Cloud CLI
          run: |
          wget https://github.com/aliyun/aliyun-cli/releases/latest/download/aliyun-cli-linux-3.0.48-amd64.tgz
          tar -xzf aliyun-cli-linux-3.0.48-amd64.tgz
          sudo ./aliyun/install



        # Configure Alibaba Cloud CLI
        aliyun configure set --region Hong Kong --access-key-id LTAI5tLGmAQtsnbv9CLX1DHV --access-key-secret w0syCcTuTogX4ZpG5Eo9q6yhSLKBzf
        
        # Deploy code to Alibaba ECS
        aliyun ecs RunCommand --InstanceIds i-j6cen21ld8zvts6xu8rf --Type RunShellScript --CommandContent 'git pull && ./deploy.sh'
